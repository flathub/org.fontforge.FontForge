app-id: org.fontforge.FontForge

runtime: org.freedesktop.Platform
runtime-version: "19.08"
sdk: org.freedesktop.Sdk

command: fontforge

finish-args:
  - --socket=x11
  - --share=ipc
  # The file picker does not use portals :(
  - --filesystem=host

cleanup:
    - "*.a"
    - "*.la"
    - "*.h"
    - "*.pc"

modules:
  - shared-modules/python2.7/python-2.7.15.json
  # We need pangoxft and it's not in the runtime
  - name: pango
    sources:
        - type: archive
          url: https://ftp.gnome.org/pub/GNOME/sources/pango/1.42/pango-1.42.4.tar.xz
          sha256: 1d2b74cd63e8bd41961f2f8d952355aa0f9be6002b52c8aa7699d9f5da597c9d

  - name: libspiro
    sources:
        - type: archive
          url: https://github.com/fontforge/libspiro/releases/download/0.5.20150702/libspiro-dist-0.5.20150702.tar.gz
          sha256: 514d215942b860c8ee77282b14e11129ecea1992f8dfcb9ea69c0f68249f6c94


  - name: libuinameslist
    sources:
        - type: archive
          url: https://github.com/fontforge/libuninameslist/releases/download/20180701/libuninameslist-dist-20180701.tar.gz
          sha256: 8aed97d0bc872d893d8bf642a14e49958b0613136e1bfe2a415c69599c803c90

  - name: fontforge
    cleanup:
         - /share/doc/fontforge
    post-install:
        - cp -a org.fontforge.FontForge.metainfo.xml /app/share/metainfo/org.fontforge.FontForge.metainfo.xml
        - cp -a org.fontforge.FontForge.metainfo.xml /app/share/metainfo/org.fontforge.FontForge.appdata.xml
        - cp -a org.fontforge.FontForge.metainfo.xml /app/share/appdata/org.fontforge.FontForge.appdata.xml
        - cp -a /app/share/mime/packages/fontforge.xml /app/share/mime/packages/org.fontforge.FontForge.xml

    sources:
        - type: archive
          url: https://github.com/fontforge/fontforge/releases/download/20190801/fontforge-20190801.tar.gz
          sha256: d92075ca783c97dc68433b1ed629b9054a4b4c74ac64c54ced7f691540f70852
        - type: file
          # We take this file, because the released version does not validate.
          # We wait for this file to be included in a release.
          # https://github.com/fontforge/fontforge/pull/3858
          url: https://raw.githubusercontent.com/fontforge/fontforge/d8f1c2ad04de86491a675efb1bf1371cd2727bfa/desktop/org.fontforge.FontForge.appdata.xml.in
          dest-filename: org.fontforge.FontForge.metainfo.xml
          sha256: ee861f9237391291fa3e376c61b928de32173785c65659d6180091b24dc4cd23
