app-id: org.fontforge.FontForge

runtime: org.freedesktop.Platform
runtime-version: '22.08'
sdk: org.freedesktop.Sdk

command: fontforge

finish-args:
  - --socket=x11
  - --share=ipc
  # The file picker does not use portals :(
  - --filesystem=host

cleanup:
  - '*.a'
  - '*.la'
  - '*.h'
  - '*.pc'

modules:
  - shared-modules/python2.7/python-2.7.15.json
  # We need pangoxft and it's not in the runtime
  - name: pango
    sources:
        - type: archive
          url: https://ftp.gnome.org/pub/GNOME/sources/pango/1.42/pango-1.42.4.tar.xz
          sha256: 1d2b74cd63e8bd41961f2f8d952355aa0f9be6002b52c8aa7699d9f5da597c9d
          x-checker-data:
            type: gnome
            name: pango
            stable-only: True
            versions:
                "<": "1.90"

  - name: libspiro
    sources:
      - type: archive
        url: https://github.com/fontforge/libspiro/releases/download/20221101/libspiro-dist-20221101.tar.gz
        sha256: 5984fb5af3e4e1f927f3a74850b705a711fb86284802a5e6170b09786440e8be
        x-checker-data:
          type: anitya
          project-id: 1725
          url-template: https://github.com/fontforge/libspiro/releases/download/$version/libspiro-dist-$version.tar.gz


  - name: libuinameslist
    sources:
      - type: archive
        url: https://github.com/fontforge/libuninameslist/releases/download/20221022/libuninameslist-dist-20221022.tar.gz
        sha256: 92c833936d653b2f205fb5e7ac82818311824dabdc7abdc2e81f07c3a0ea39bb
        x-checker-data:
          type: json
          url: https://api.github.com/repos/fontforge/libuninameslist/releases/latest
          version-query: .tag_name
          url-query: .assets[] | select(.name=="libuninameslist-dist-" + $version
            + ".tar.gz") | .browser_download_url

  - name: woff2
    buildsystem: cmake-ninja
    builddir: true
    sources:
      - type: archive
        url: https://github.com/google/woff2/archive/v1.0.2.tar.gz
        sha256: add272bb09e6384a4833ffca4896350fdb16e0ca22df68c0384773c67a175594
        x-checker-data:
          type: anitya
          project-id: 17587
          url-template: https://github.com/google/woff2/archive/v$version.tar.gz

  - name: fontforge
    buildsystem: cmake-ninja
    builddir: true
    cleanup:
      - /share/doc/fontforge
    post-install:
      - cp -a --reflink=auto  /app/share/mime/packages/fontforge.xml /app/share/mime/packages/org.fontforge.FontForge.xml

    sources:
      - type: archive
        url: https://github.com/fontforge/fontforge/releases/download/20230101/fontforge-20230101.tar.xz
        sha256: ca82ec4c060c4dda70ace5478a41b5e7b95eb035fe1c4cf85c48f996d35c60f8
        x-checker-data:
          type: anitya
          project-id: 5807
          url-template: https://github.com/fontforge/fontforge/releases/download/$version/fontforge-$version.tar.xz
